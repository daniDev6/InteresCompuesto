<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Calculadora Interés Compuesto</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <main class="container" role="main" aria-labelledby="title">
    <header>
      <div>
        <h1 id="title">Calculadora de Interés Compuesto</h1>
        <p>Introduce los valores y obtén un desglose anual + resumen.</p>
      </div>
    </header>

    <section class="grid" aria-label="Formulario y resultados">
      <form class="card" id="form" onsubmit="return false;" aria-labelledby="title">
        <div>
          <label for="principal">Plata inicial</label>
          <input id="principal" type="number" min="0" step="0.01" value="3000" required aria-describedby="helpPrincipal">
          <div id="helpPrincipal" class="small">Cantidad con la que arrancás (ej: 3000).</div>
        </div>

        <div style="margin-top:10px">
          <label for="rate">Interés anual (%)</label>
          <input id="rate" type="number" min="0" step="0.01" value="5" required>
        </div>

        <div style="margin-top:10px" class="row">
          <div>
            <label for="years">Cantidad de años</label>
            <input id="years" type="number" min="1" step="1" value="10" required>
          </div>
          <div>
            <label for="reinvestPct">¿Cuánto desea reinvertir? (%)</label>
            <input id="reinvestPct" type="number" min="0" max="10000" step="0.1" value="100" required>
            <div class="small">Porcentaje del interés que se reinvierte cada año. 100 = reinvertir todo.</div>
          </div>
        </div>

        <div class="actions">
          <button id="calculate">Calcular</button>
          <button id="reset" class="ghost" type="button">Reset</button>
          <button id="exportCsv" class="ghost" type="button">Exportar CSV</button>
        </div>

        <div id="summary" class="results" aria-live="polite" hidden>
          <!-- resumen dinámico -->
        </div>
      </form>

      <div class="card" id="outputCard" aria-live="polite">
        <h3 style="margin:0 0 8px 0">Detalle anual</h3>
        <div id="tableWrapper" style="overflow:auto; max-height:520px">
          <table id="resultTable" aria-describedby="tableDesc">
            <thead>
              <tr>
                <th>Año</th>
                <th>Saldo inicio</th>
                <th>Interés ganado</th>
                <th>Reinvertido</th>
                <th>Saldo fin</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div id="tableDesc" class="small" style="margin-top:8px">Tabla con el flujo por año.</div>
        </div>
      </div>
    </section>

  </main>

  <script>
// Form elements
const principalInput = document.getElementById('principal');
const rateInput = document.getElementById('rate');
const yearsInput = document.getElementById('years');
const reinvestInput = document.getElementById('reinvestPct');

const calculateBtn = document.getElementById('calculate');
const resetBtn = document.getElementById('reset');
const exportBtn = document.getElementById('exportCsv');

const resultTableBody = document.querySelector('#resultTable tbody');
const summaryDiv = document.getElementById('summary');

// Helper: formatos
const fmt = (v) => {
    // Presentación con símbolo $ y separador de miles
    // no usamos Intl currency específico para evitar dependencias
    const num = Number(v);
    if (!isFinite(num)) return v;
    return '$' + num.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, '.');
};

function clearOutputs() {
    resultTableBody.innerHTML = '';
    summaryDiv.innerHTML = '';
    summaryDiv.hidden = true;
}

function calculate() {
    clearOutputs();

    const P = parseFloat(principalInput.value);
    const rPct = parseFloat(rateInput.value);
    const nYears = parseInt(yearsInput.value, 10);
    const reinvestPct = parseFloat(reinvestInput.value);

    if (isNaN(P) || P < 0 || isNaN(rPct) || isNaN(nYears) || nYears <= 0 || reinvestPct < 0 || reinvestPct > 10000) {
        alert('Por favor verifica los valores. Años debe ser >= 1 y reinvertir entre 0 y 10000.');
        return;
    }

    const r = rPct / 100;
    const reinvestFraction = reinvestPct / 100;

    let saldo = P;
    let totalInteres = 0;
    let totalReinvertido = 0;
    let totalRetirado = 0;

    const rows = [];

    for (let year = 1; year <= nYears; year++) {
        const interes = saldo * r;
        const reinvertido = interes * reinvestFraction;
        const saldoFin = saldo + reinvertido;

        rows.push({
            year,
            saldoInicio: saldo,
            interes,
            reinvertido,
            saldoFin
        });

        totalInteres += interes;
        totalReinvertido += reinvertido;
        saldo = saldoFin;
    }

    // Poblamos la tabla
    const frag = document.createDocumentFragment();
    rows.forEach(rw => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${rw.year}</td>
          <td>${fmt(rw.saldoInicio)}</td>
          <td>${fmt(rw.interes)}</td>
          <td>${fmt(rw.reinvertido)}</td>
          <td>${fmt(rw.saldoFin)}</td>
        `;
        frag.appendChild(tr);
    });
    resultTableBody.appendChild(frag);

    // Resumen
    const finalSaldo = saldo;
    summaryDiv.hidden = false;
    summaryDiv.innerHTML = `
        <strong>Resumen</strong>
        <div class="small" style="margin-top:6px">
          Saldo final: <strong>${fmt(finalSaldo)}</strong><br>
          Interés total ganado: <strong>${fmt(totalInteres)}</strong><br>
          Total reinvertido: <strong>${fmt(totalReinvertido)}</strong><br>
        </div>
      `;

    // Habilitar export
    exportBtn.disabled = false;
    exportBtn.dataset.csv = buildCSV(rows);
}

function buildCSV(rows) {
    const headers = ['Año', 'Saldo inicio', 'Interés ganado', 'Reinvertido', 'Saldo fin'];
    const lines = [headers.join(',')];
    rows.forEach(rw => {
        lines.push([
            rw.year,
            rw.saldoInicio.toFixed(2),
            rw.interes.toFixed(2),
            rw.reinvertido.toFixed(2),
            rw.saldoFin.toFixed(2)
        ].join(','));
    });
    return lines.join('\n');
}

calculateBtn.addEventListener('click', (e) => {
    e.preventDefault();
    calculate();
});

resetBtn.addEventListener('click', () => {
    principalInput.value = '3000';
    rateInput.value = '5';
    yearsInput.value = '10';
    reinvestInput.value = '100';
    clearOutputs();
});

exportBtn.addEventListener('click', () => {
    const csv = exportBtn.dataset.csv;
    if (!csv) {
        alert('Primero realiza el cálculo para poder exportar.');
        return;
    }
    const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'interes_compuesto.csv';
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
});

// Ejecutar cálculo inicial para mostrar ejemplo
window.addEventListener('load', () => {
    calculate();
});

  </script>

</body>
</html>
